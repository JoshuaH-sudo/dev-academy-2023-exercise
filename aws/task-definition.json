name: hsl-app
services:
  app_database:
    deploy:
      resources:
        limits:
          cpus: "2"
          memory: "17179869184"
    environment:
      MONGO_INITDB_ROOT_PASSWORD: ewk5JFZ_vnc*jbt3vzv
      MONGO_INITDB_ROOT_USERNAME: admin
    image: mongo
    networks:
      default: null
    ports:
    - mode: ingress
      target: 27017
      published: "27017"
      protocol: tcp
    restart: always
    volumes:
    - type: volume
      source: mongo-data
      target: /data/db
      volume: {}
  hsl_bike_app:
    depends_on:
      app_database:
        condition: service_started
    deploy:
      resources:
        limits:
          cpus: "2"
          memory: "17179869184"
    environment:
      MONGO_URI: mongodb://admin:ewk5JFZ_vnc*jbt3vzv@app_database:27017/?authMechanism=DEFAULT
      NODE_ENV: production
      PORT: "8080"
    image: joshuahsudo/hsl_bike_app:latest
    networks:
      default: null
    ports:
    - mode: ingress
      target: 8080
      published: "8080"
      protocol: tcp
    working_dir: /home/node/app
networks:
  default:
    name: hsl-app_default
volumes:
  mongo-data:
    name: hsl-app_mongo-data
name: hsl-app
services:
  app_database:
    deploy:
      resources:
        limits:
          cpus: "2"
          memory: "17179869184"
    environment:
      MONGO_INITDB_ROOT_PASSWORD: ewk5JFZ_vnc*jbt3vzv
      MONGO_INITDB_ROOT_USERNAME: admin
    image: mongo
    networks:
      default: null
    ports:
    - mode: ingress
      target: 27017
      published: "27017"
      protocol: tcp
    restart: always
    volumes:
    - type: volume
      source: mongo-data
      target: /data/db
      volume: {}
  hsl_bike_app:
    depends_on:
      app_database:
        condition: service_started
    deploy:
      resources:
        limits:
          cpus: "2"
          memory: "17179869184"
    environment:
      MONGO_URI: mongodb://admin:ewk5JFZ_vnc*jbt3vzv@app_database:27017/?authMechanism=DEFAULT
      NODE_ENV: production
      PORT: "8080"
    image: joshuahsudo/hsl_bike_app:latest
    networks:
      default: null
    ports:
    - mode: ingress
      target: 8080
      published: "8080"
      protocol: tcp
    working_dir: /home/node/app
networks:
  default:
    name: hsl-app_default
volumes:
  mongo-data:
    name: hsl-app_mongo-data
name: hsl-app
services:
  app_database:
    deploy:
      resources:
        limits:
          cpus: "2"
          memory: "17179869184"
    environment:
      MONGO_INITDB_ROOT_PASSWORD: ""
      MONGO_INITDB_ROOT_USERNAME: ""
    image: mongo
    networks:
      default: null
    ports:
    - mode: ingress
      target: 27017
      published: "27017"
      protocol: tcp
    restart: always
    secrets:
    - source: database_secrets
    volumes:
    - type: volume
      source: mongo-data
      target: /data/db
      volume: {}
  hsl_bike_app:
    depends_on:
      app_database:
        condition: service_started
    deploy:
      resources:
        limits:
          cpus: "2"
          memory: "17179869184"
    environment:
      MONGO_URI: mongodb://admin:ewk5JFZ_vnc*jbt3vzv@app_database:27017/?authMechanism=DEFAULT
      NODE_ENV: production
      PORT: "8080"
    image: joshuahsudo/hsl_bike_app:latest
    networks:
      default: null
    ports:
    - mode: ingress
      target: 8080
      published: "8080"
      protocol: tcp
    working_dir: /home/node/app
networks:
  default:
    name: hsl-app_default
volumes:
  mongo-data:
    name: hsl-app_mongo-data
secrets:
  database_secrets:
    name: hsl-app_database_secrets
    file: /root/projects/dev-academy-2023-exercise/database.env
name: hsl-app
services:
  app_database:
    image: mongo
    networks:
      default: null
    ports:
    - mode: ingress
      target: 27017
      published: "27017"
      protocol: tcp
    restart: always
    volumes:
    - type: volume
      source: mongo-data
      target: /data/db
      volume: {}
  hsl_bike_app:
    build:
      context: /root/projects/dev-academy-2023-exercise
      dockerfile: ./docker/dockerfile.dev.yml
    depends_on:
      app_database:
        condition: service_started
    environment:
      MONGO_URI: mongodb://app_database:27017/dev-academy
      NODE_ENV: development
      PORT: "8080"
    networks:
      default: null
    ports:
    - mode: ingress
      target: 8080
      published: "8080"
      protocol: tcp
    secrets:
    - source: database_secrets
    working_dir: /home/node/app
networks:
  default:
    name: hsl-app_default
volumes:
  mongo-data:
    name: hsl-app_mongo-data
secrets:
  database_secrets:
    name: hsl-app_database_secrets
    file: /root/projects/dev-academy-2023-exercise/database.env
name: hsl-app
services:
  app_database:
    deploy:
      resources:
        limits:
          cpus: "2"
          memory: "17179869184"
    environment:
      MONGO_INITDB_ROOT_PASSWORD: ewk5JFZ_vnc*jbt3vzv
      MONGO_INITDB_ROOT_USERNAME: admin
    image: mongo
    networks:
      default: null
    ports:
    - mode: ingress
      target: 27017
      published: "27017"
      protocol: tcp
    restart: always
    secrets:
    - source: database_secrets
    volumes:
    - type: volume
      source: mongo-data
      target: /data/db
      volume: {}
  hsl_bike_app:
    depends_on:
      app_database:
        condition: service_started
    deploy:
      resources:
        limits:
          cpus: "2"
          memory: "17179869184"
    environment:
      MONGO_URI: mongodb://admin:ewk5JFZ_vnc*jbt3vzv@app_database:27017/?authMechanism=DEFAULT
      NODE_ENV: production
      PORT: "8080"
    image: joshuahsudo/hsl_bike_app:latest
    networks:
      default: null
    ports:
    - mode: ingress
      target: 8080
      published: "8080"
      protocol: tcp
    working_dir: /home/node/app
networks:
  default:
    name: hsl-app_default
volumes:
  mongo-data:
    name: hsl-app_mongo-data
secrets:
  database_secrets:
    name: hsl-app_database_secrets
    file: /root/projects/dev-academy-2023-exercise/database.env
name: hsl-app
services:
  app_database:
    deploy:
      resources:
        limits:
          cpus: "2"
          memory: "17179869184"
    entrypoint:
    - /bin/sh
    - -c
    - source /run/secrets/database_environment
    image: mongo
    networks:
      default: null
    ports:
    - mode: ingress
      target: 27017
      published: "27017"
      protocol: tcp
    restart: always
    secrets:
    - source: database_environment
    volumes:
    - type: volume
      source: mongo-data
      target: /data/db
      volume: {}
  hsl_bike_app:
    depends_on:
      app_database:
        condition: service_started
    deploy:
      resources:
        limits:
          cpus: "2"
          memory: "17179869184"
    entrypoint:
    - /bin/sh
    - -c
    - source /run/secrets/app_environment
    image: joshuahsudo/hsl_bike_app:latest
    networks:
      default: null
    ports:
    - mode: ingress
      target: 8080
      published: "8080"
      protocol: tcp
    secrets:
    - source: app_environment
    working_dir: /home/node/app
networks:
  default:
    name: hsl-app_default
volumes:
  mongo-data:
    name: hsl-app_mongo-data
secrets:
  app_environment:
    name: hsl-app_app_environment
    file: /root/projects/dev-academy-2023-exercise/.env
  database_environment:
    name: hsl-app_database_environment
    file: /root/projects/dev-academy-2023-exercise/database.env
